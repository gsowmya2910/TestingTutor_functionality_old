using System.IO;
using System.Text;
using System.Xml.Serialization;
using TestingTutor.JavaEngine.Engine.CoverageXml;
using Xunit;

namespace TestingTutor.Tests.JavaEngine
{
    public class CodeCoverageSerializationTest : TestBase
    {
        private const string CodeCoverageXmlReport = "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?><!DOCTYPE report PUBLIC \"-//JACOCO//DTD Report 1.1//EN\" \"report.dtd\"><report name=\"JaCoCo Coverage Report\"><sessioninfo id=\"STARLIGHT-d9214f79\" start=\"1549430277896\" dump=\"1549430278058\"/><sessioninfo id=\"STARLIGHT-ae0dc17b\" start=\"1549430601085\" dump=\"1549430601230\"/><sessioninfo id=\"STARLIGHT-52125fba\" start=\"1549430669875\" dump=\"1549430669977\"/><sessioninfo id=\"STARLIGHT-54b7c5b4\" start=\"1549430719675\" dump=\"1549430719777\"/><sessioninfo id=\"STARLIGHT-38de17cd\" start=\"1549430794382\" dump=\"1549430794521\"/><sessioninfo id=\"STARLIGHT-4bf6b2ce\" start=\"1549430903239\" dump=\"1549430903445\"/><package name=\"Questions\"><class name=\"Questions/Loan\" sourcefilename=\"Loan.java\"><method name=\"&lt;init&gt;\" desc=\"()V\" line=\"16\"><counter type=\"INSTRUCTION\" missed=\"18\" covered=\"0\"/><counter type=\"LINE\" missed=\"7\" covered=\"0\"/><counter type=\"COMPLEXITY\" missed=\"1\" covered=\"0\"/><counter type=\"METHOD\" missed=\"1\" covered=\"0\"/></method><method name=\"&lt;init&gt;\" desc=\"(Ljava/lang/String;DDDD)V\" line=\"25\"><counter type=\"INSTRUCTION\" missed=\"0\" covered=\"18\"/><counter type=\"LINE\" missed=\"0\" covered=\"7\"/><counter type=\"COMPLEXITY\" missed=\"0\" covered=\"1\"/><counter type=\"METHOD\" missed=\"0\" covered=\"1\"/></method><method name=\"setHolder\" desc=\"(Ljava/lang/String;)V\" line=\"35\"><counter type=\"INSTRUCTION\" missed=\"0\" covered=\"4\"/><counter type=\"LINE\" missed=\"0\" covered=\"2\"/><counter type=\"COMPLEXITY\" missed=\"0\" covered=\"1\"/><counter type=\"METHOD\" missed=\"0\" covered=\"1\"/></method><method name=\"getHolder\" desc=\"()Ljava/lang/String;\" line=\"42\"><counter type=\"INSTRUCTION\" missed=\"0\" covered=\"3\"/><counter type=\"LINE\" missed=\"0\" covered=\"1\"/><counter type=\"COMPLEXITY\" missed=\"0\" covered=\"1\"/><counter type=\"METHOD\" missed=\"0\" covered=\"1\"/></method><method name=\"qualifiesForBonus\" desc=\"(D)Z\" line=\"47\"><counter type=\"INSTRUCTION\" missed=\"4\" covered=\"18\"/><counter type=\"BRANCH\" missed=\"4\" covered=\"4\"/><counter type=\"LINE\" missed=\"2\" covered=\"3\"/><counter type=\"COMPLEXITY\" missed=\"4\" covered=\"1\"/><counter type=\"METHOD\" missed=\"0\" covered=\"1\"/></method><method name=\"calculateInterest\" desc=\"()D\" line=\"73\"><counter type=\"INSTRUCTION\" missed=\"0\" covered=\"17\"/><counter type=\"LINE\" missed=\"0\" covered=\"1\"/><counter type=\"COMPLEXITY\" missed=\"0\" covered=\"1\"/><counter type=\"METHOD\" missed=\"0\" covered=\"1\"/></method><method name=\"toString\" desc=\"()Ljava/lang/String;\" line=\"79\"><counter type=\"INSTRUCTION\" missed=\"8\" covered=\"0\"/><counter type=\"LINE\" missed=\"1\" covered=\"0\"/><counter type=\"COMPLEXITY\" missed=\"1\" covered=\"0\"/><counter type=\"METHOD\" missed=\"1\" covered=\"0\"/></method><counter type=\"INSTRUCTION\" missed=\"30\" covered=\"60\"/><counter type=\"BRANCH\" missed=\"4\" covered=\"4\"/><counter type=\"LINE\" missed=\"10\" covered=\"14\"/><counter type=\"COMPLEXITY\" missed=\"6\" covered=\"5\"/><counter type=\"METHOD\" missed=\"2\" covered=\"5\"/><counter type=\"CLASS\" missed=\"0\" covered=\"1\"/></class><class name=\"Questions/Main\" sourcefilename=\"Main.java\"><method name=\"&lt;init&gt;\" desc=\"()V\" line=\"7\"><counter type=\"INSTRUCTION\" missed=\"3\" covered=\"0\"/><counter type=\"LINE\" missed=\"1\" covered=\"0\"/><counter type=\"COMPLEXITY\" missed=\"1\" covered=\"0\"/><counter type=\"METHOD\" missed=\"1\" covered=\"0\"/></method><method name=\"main\" desc=\"([Ljava/lang/String;)V\" line=\"12\"><counter type=\"INSTRUCTION\" missed=\"24\" covered=\"0\"/><counter type=\"LINE\" missed=\"5\" covered=\"0\"/><counter type=\"COMPLEXITY\" missed=\"1\" covered=\"0\"/><counter type=\"METHOD\" missed=\"1\" covered=\"0\"/></method><counter type=\"INSTRUCTION\" missed=\"27\" covered=\"0\"/><counter type=\"LINE\" missed=\"6\" covered=\"0\"/><counter type=\"COMPLEXITY\" missed=\"2\" covered=\"0\"/><counter type=\"METHOD\" missed=\"2\" covered=\"0\"/><counter type=\"CLASS\" missed=\"1\" covered=\"0\"/></class><sourcefile name=\"Main.java\"><line nr=\"7\" mi=\"3\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"12\" mi=\"4\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"13\" mi=\"5\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"16\" mi=\"9\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"17\" mi=\"5\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"22\" mi=\"1\" ci=\"0\" mb=\"0\" cb=\"0\"/><counter type=\"INSTRUCTION\" missed=\"27\" covered=\"0\"/><counter type=\"LINE\" missed=\"6\" covered=\"0\"/><counter type=\"COMPLEXITY\" missed=\"2\" covered=\"0\"/><counter type=\"METHOD\" missed=\"2\" covered=\"0\"/><counter type=\"CLASS\" missed=\"1\" covered=\"0\"/></sourcefile><sourcefile name=\"Loan.java\"><line nr=\"16\" mi=\"2\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"17\" mi=\"3\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"18\" mi=\"3\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"19\" mi=\"3\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"20\" mi=\"3\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"21\" mi=\"3\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"22\" mi=\"1\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"25\" mi=\"0\" ci=\"2\" mb=\"0\" cb=\"0\"/><line nr=\"26\" mi=\"0\" ci=\"3\" mb=\"0\" cb=\"0\"/><line nr=\"27\" mi=\"0\" ci=\"3\" mb=\"0\" cb=\"0\"/><line nr=\"28\" mi=\"0\" ci=\"3\" mb=\"0\" cb=\"0\"/><line nr=\"29\" mi=\"0\" ci=\"3\" mb=\"0\" cb=\"0\"/><line nr=\"30\" mi=\"0\" ci=\"3\" mb=\"0\" cb=\"0\"/><line nr=\"31\" mi=\"0\" ci=\"1\" mb=\"0\" cb=\"0\"/><line nr=\"35\" mi=\"0\" ci=\"3\" mb=\"0\" cb=\"0\"/><line nr=\"38\" mi=\"0\" ci=\"1\" mb=\"0\" cb=\"0\"/><line nr=\"42\" mi=\"0\" ci=\"3\" mb=\"0\" cb=\"0\"/><line nr=\"47\" mi=\"0\" ci=\"8\" mb=\"2\" cb=\"2\"/><line nr=\"49\" mi=\"2\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"51\" mi=\"0\" ci=\"8\" mb=\"2\" cb=\"2\"/><line nr=\"53\" mi=\"0\" ci=\"2\" mb=\"0\" cb=\"0\"/><line nr=\"57\" mi=\"2\" ci=\"0\" mb=\"0\" cb=\"0\"/><line nr=\"73\" mi=\"0\" ci=\"17\" mb=\"0\" cb=\"0\"/><line nr=\"79\" mi=\"8\" ci=\"0\" mb=\"0\" cb=\"0\"/><counter type=\"INSTRUCTION\" missed=\"30\" covered=\"60\"/><counter type=\"BRANCH\" missed=\"4\" covered=\"4\"/><counter type=\"LINE\" missed=\"10\" covered=\"14\"/><counter type=\"COMPLEXITY\" missed=\"6\" covered=\"5\"/><counter type=\"METHOD\" missed=\"2\" covered=\"5\"/><counter type=\"CLASS\" missed=\"0\" covered=\"1\"/></sourcefile><counter type=\"INSTRUCTION\" missed=\"57\" covered=\"60\"/><counter type=\"BRANCH\" missed=\"4\" covered=\"4\"/><counter type=\"LINE\" missed=\"16\" covered=\"14\"/><counter type=\"COMPLEXITY\" missed=\"8\" covered=\"5\"/><counter type=\"METHOD\" missed=\"4\" covered=\"5\"/><counter type=\"CLASS\" missed=\"1\" covered=\"1\"/></package><counter type=\"INSTRUCTION\" missed=\"57\" covered=\"60\"/><counter type=\"BRANCH\" missed=\"4\" covered=\"4\"/><counter type=\"LINE\" missed=\"16\" covered=\"14\"/><counter type=\"COMPLEXITY\" missed=\"8\" covered=\"5\"/><counter type=\"METHOD\" missed=\"4\" covered=\"5\"/><counter type=\"CLASS\" missed=\"1\" covered=\"1\"/></report>";

        [Fact]
        public void CodeCoverageXml_ShouldSerializeProperly()
        {
            var xRoot = new XmlRootAttribute()
            {
                ElementName = "report",
                IsNullable = true
            };

            var xs = new XmlSerializer(typeof(Report), xRoot);
            var buffer = Encoding.UTF8.GetBytes(CodeCoverageXmlReport);
            using (var stream = new MemoryStream(buffer))
            {
                var report = (Report) xs.Deserialize(stream);
            }
        }


    }
}
